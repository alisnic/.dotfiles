#!/usr/bin/env ruby
require 'find'
require 'similar_text'

def get_spec(source)
  source_name = File.basename(source).split(".").first
  candidates  = []
  spec_dir    = File.join(Dir.pwd, "spec")
  extension   = File.extname(source)

  if source_name.end_with?("_spec")
    return source
  end

  Find.find(spec_dir) do |path|
    name = File.basename(path)
    if name == source_name + "_spec" + extension
      candidates.push(path)
    end
  end

  candidates.max do |path|
    source.similar(path)
  end
end

STDOUT.puts get_spec(ARGF.argv.first)

